# 要件定義書 (Requirements Document)

## 1. 機能要件 (Functional Requirements)

### 1.1. コンテンツ収集・管理 (Backend)
*   **自動スクレイピング機能**:
    *   指定されたBBC Learning Englishの番組ページを定期的に巡回する。
    *   最新のエピソードを検知し、以下の情報を抽出する。
        *   タイトル
        *   公開日
        *   音声ファイルURL (mp3)
        *   スクリプト（会話文）
        *   語彙リスト（単語と定義）
        *   サムネイル画像URL
    *   抽出したデータをデータベース(Firestore)に保存・更新する。
    *   **対応済み番組**:
        *   6 Minute English
        *   The English We Speak
        *   Real Easy English
*   **手動同期トリガー**:
    *   アプリ側からのリクエストにより、オンデマンドで最新情報のチェック・取得を行えるようにする。

### 1.2. 学習機能 (Mobile App)
*   **エピソード一覧・詳細表示**:
    *   番組ごとのエピソード一覧を表示する。
    *   エピソード詳細画面で、スクリプト、語彙、音声プレーヤーを表示する。
*   **音声再生機能**:
    *   エピソードの音声を再生・一時停止・シークできる。
    *   バックグラウンド再生に対応する。
    *   再生速度の変更（0.8x, 1.0x, 1.2x, 1.5xなど）に対応する。
*   **スクリプト表示機能**:
    *   音声に合わせてスクリプトを閲覧できる。
    *   （将来的な拡張）音声の再生位置に合わせてスクリプトをハイライトする機能（※データ構造依存）。
*   **単語帳・語彙学習機能**:
    *   エピソードから抽出された重要単語リストを表示する。
    *   ユーザーが任意の単語を「ブックマーク」または「学習中」として保存できる。
    *   保存した単語を確認できる「マイ単語帳」画面を提供する。
*   **オフライン学習機能**:
    *   エピソードデータ（テキスト・音声）を端末にダウンロードし、インターネット接続がない環境でも学習可能にする。

### 1.3. ユーザー設定・管理
*   **認証機能 (Authentication)**:
    *   アプリ利用者の制限およびデータ保護のため、認証機能を実装する（Firebase Authentication推奨）。
    *   ポートフォリオとしての配布を考慮し、ゲストログインまたは招待制（メールアドレス制限など）の仕組みを検討する。
*   **学習履歴管理**:
    *   再生済みのエピソードを既読（再生済み）としてマークする。
    *   最後に再生した位置を記憶する。

### 1.4. 配布・パッケージング
*   **ビルド生成**:
    *   Android (APK) および iOS (IPA/TestFlight) 形式でのビルドが可能であること。
    *   環境変数（APIキー等）をビルド時に注入できる構成とすること。

## 2. 非機能要件 (Non-Functional Requirements)

### 2.1. 運用コスト・効率性
*   **低コスト運用**:
    *   GCPの無料枠（Free Tier）を最大限活用する設計とする。
    *   Cloud Functionsの実行時間は必要最小限に抑える。
    *   FirestoreのRead/Write回数を削減するため、クライアント側でのキャッシュ戦略を導入する。

### 2.2. パフォーマンス
*   **レスポンス速度**:
    *   アプリ内の画面遷移やデータ表示は、ユーザーにストレスを与えない速度（数秒以内）で完了すること。
*   **起動時間**:
    *   アプリの起動から学習開始までの時間を短縮する。

### 2.3. 可用性・信頼性
*   **エラーハンドリング**:
    *   スクレイピング対象のサイト構造変更などにより取得に失敗した場合でも、システム全体が停止せず、エラーログを適切に記録すること。
    *   アプリ側では、通信エラー時などに適切なメッセージを表示し、オフラインデータがある場合はそちらを優先して表示する。

### 2.4. セキュリティ
*   **データ保護**:
    *   Firestoreのセキュリティルールを適切に設定し、不正な書き込みや意図しないデータの読み取りを防ぐ。
*   **通信の暗号化**:
    *   アプリとサーバー間の通信はすべてHTTPSで行う。

### 2.5. 拡張性
*   **多番組対応**:
    *   設定ファイルやスクレイパーの追加により、新しい番組（例: The English We Speak, News Reviewなど）を容易に追加できる構造にする。
